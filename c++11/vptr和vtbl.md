# 虚指针和虚表

![image-20230628101200465](/home/lyt/2023/c++11/assets/image-20230628101200465.png)

继承会把数据继承下来，**还会把函数继承下来** ---继承的是调用权不是内存大小



虚表--指针数组

```c++
//可以把以上三个调用函数的步骤用以下表达式来表示：
*(p->vptr)[n](p);
//n 就是表中从上往下数  0 1 2 3  4 的位置
```

![image-20230628103905843](/home/lyt/2023/c++11/assets/image-20230628103905843.png)

谁是一种谁，谁是子类谁是父类，正方形 和 矩形？？

为类让容器容纳各种形状，容器指定的时候必须放指针---因为形状大小都不一样(内存占中空间)

1. 遍历整个容器，取出每个指针，然后调用画图函数(draw)，**各自写各自draw**，就像相当于上个的**func1**

   1. 用c的话，就是if(是不是圆形) 是就调用draw_圆形 的函数
   2. c++。虚函数---指针指向什么类型，就调用对应类型的函数
   3. c++编译器，看到函数调用，两个考量 -- 静态绑定还是动态绑定

   

   ```c
   *(p->vptr)[n](p);
   //满足以下条件就走动态绑定
   //具体调用那个函数--看p指向谁
   //静态绑定一定指向某个地址，动态绑定要看p指向的谁--a b c ？
   ```

   

   - 通过指针

   - 向上转型--`A *p = new B`
   - 调用虚函数



- 多态，虚函数，动态绑定 都是一种走的是虚指针虚表

# Dynamic Binding

![image-20230628115809377](/home/lyt/2023/c++11/assets/image-20230628115809377.png)

```
B b;
A a = (A)b;
a.vfunc1(); //静态绑定

A *pa = new B;
pa->vfunc1();
```

![image-20230628120023488](/home/lyt/2023/c++11/assets/image-20230628120023488.png)

**call**---调用虚函数